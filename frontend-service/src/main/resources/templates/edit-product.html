<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Editar producto</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}" />
</head>
<body>
<h1>Editar producto</h1>
<div th:if="${errorMessage}" th:text="${errorMessage}" style="color:red"></div>
<div th:if="${isLogged}">
    <form th:action="@{'/products/' + ${product.id} + '/edit'}" th:object="${product}" method="post" enctype="multipart/form-data">
    <input type="hidden" th:field="*{id}" />
    <!-- preserve current image URL so backend update won't null it when no new file uploaded -->
    <input type="hidden" th:field="*{imageUrl}" />
    <div>
        <label for="name">Nombre</label>
        <input id="name" type="text" th:field="*{name}" required />
    </div>
    <div>
        <label for="description">Descripción</label>
        <textarea id="description" th:field="*{description}"></textarea>
    </div>
    <div>
        <label for="price">Precio</label>
        <input id="price" type="number" step="0.01" th:field="*{price}" required />
    </div>
    <div>
        <label for="stock">Stock</label>
        <input id="stock" type="number" th:field="*{stock}" required />
    </div>
    <div>
        <label for="category">Categoría</label>
        <!-- product-service returns a list of category names (String), use product.category -->
        <select id="category" th:field="*{category}">
            <option th:each="cat : ${categories}" th:value="${cat}" th:text="${cat}"></option>
        </select>
    </div>
    <div>
        <label>Imagen actual</label>
        <div>
            <img th:src="${product.imageUrl}" alt="Imagen" style="max-width:200px;max-height:200px;" onerror="this.src='/images/default-product.png'" />
        </div>
    </div>
    <div>
        <label for="imageFile">Subir nueva imagen (opcional)</label>
        <input id="imageFile" name="imageFile" type="file" accept="image/*" />
    </div>
    <div>
        <button type="submit">Guardar cambios</button>
        <a th:href="@{/products}">Cancelar</a>
    </div>
</form>
</div>
<div th:unless="${isLogged}">
    <p>No tienes permisos para editar este producto. <a th:href="@{/login}">Inicia sesión</a></p>
</div>
</body>
</html>
