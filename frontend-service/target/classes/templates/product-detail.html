<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Detalle de Producto - EcommercePro</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
</head>
<body class="bg-light">
    <div th:replace="~{fragments/navbar :: navbar}"></div>
    <div class="main-container container py-5">
        <div class="row justify-content-center">
            <div class="col-md-8" th:if="${product != null}">
                <div class="card shadow-sm">
                    <div class="row g-0">
                        <div class="col-md-5">
                       <img th:src="${product.imageUrl}" class="img-fluid rounded-start" alt="Imagen del producto"
                           onerror="this.onerror=null;this.src='/images/default-product.png'" />
                        </div>
                        <div class="col-md-7">
                            <div class="card-body">
                                <h3 class="card-title fw-bold" th:text="${product.name}"></h3>
                                <p class="card-text text-muted" th:text="${product.description}"></p>
                                <h4 class="text-primary fw-bold mb-3" th:text="${product.price != null ? 'S/ ' + #numbers.formatDecimal(product.price, 1, 'POINT', 2, 'COMMA') : 'S/ 0.00'}"></h4>
                                <form th:action="@{/cart/add}" method="post" class="add-to-cart-ajax" novalidate>
                                    <input type="hidden" name="productId" th:value="${product.id}" />
                                    <div class="mb-3">
                                        <label for="quantity" class="form-label">Cantidad</label>
                                        <input type="number" id="quantity" name="quantity" class="form-control" min="1" th:attr="max=${product.stock}" value="1" required />
                                        <div class="invalid-feedback">La cantidad debe ser entre 1 y 99.</div>
                                    </div>
                                    <button type="submit" id="addToCartBtn" class="btn btn-success" th:disabled="${product.stock == 0}">
                                        <span th:text="${product.stock == 0} ? 'Sin stock' : 'Agregar al carrito'"></span>
                                    </button>
                                </form>
                                <div th:replace="~{fragments/alerts :: alerts}"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>
